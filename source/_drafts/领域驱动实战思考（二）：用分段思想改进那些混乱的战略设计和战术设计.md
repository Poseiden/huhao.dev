---
title: 领域驱动实战思考（二）：用分段思想改进那些混乱的战略设计和战术设计
categories:
  - Domain Driven Development
tags:
  - DDD
abbrlink: 58fe0824
---

## 前言

2019年，在我[对DDD进行基准化](https://huhao.dev/posts/130bb570/)的过程中，遇到过非常多的挑战，其中一个便是：

**DDD的设计过程，到底应该分为多少个阶段？每个阶段做什么事情？**

这个困惑来自于书本上，以及其他咨询师在咨询过程中对于DDD设计和操作的差异：

- 有的人会从电梯演讲和用户地图开始做设计和分析；
- 有的人会从事件风暴开始做设计和分析；
- 有的人会从子域开始做设计和分析；
- 有的人会从限界上下文开始做设计和分析；
- 有的人会直接从领域建模的聚合、实体、值对象开始做设计和分析；
- 当然，还有的人会使用“名词动词法”直接从用例描述开始做设计和分析。

对于实际的学习者和使用者来说，这种混乱的操作手法所形成的不一致和不流畅体验，对于坚持进行DDD设计和减少吵架来说，简直是一种毁灭性的影响。

在这个过程中，最让我感触深刻的，是在于大家在落地DDD的时候，使用了大量具有“二义性”的词汇，讽刺的是，这与DDD所强调的统一语言是背道而驰的。

其中对于上述混乱影响最大的因素之一，就是大家对于DDD的“战略设计”和“战术设计”认知不一致（甚至说是混沌）的问题。

所以，这篇文章，就是围绕这两个概念，来说一说我是如何在基准化的过程中解决这个问题，统一并形成较为流畅的分段式的设计过程的。

<!-- more -->

## 混乱的战略设计和战术设计

一谈起“战略设计”和“战术设计”，你一定会听到“问题域”、“方案域”、“实现域”等名词。

我的同事肖然在经过反复理解和提炼之后，曾经提出过一个用于解释“问题与方案”、“战略与战术”的“元模型”：

{% asset_img DDD-Essence.png 500 "从问题/解决方案和战略/战术维度分析DDD元模型的元素" %}

这个模型其实对于具备多维思维和对DDD有着深入理解的人来说，是一种不错的可视化辅助理解手段（划分的合理性仅供参考）。但是在成为更多的咨询师做DDD咨询或培训时开篇必用的材料之后，事情就变得诡异了。因为这个元模型对于咨询师或者培训师是一个比较好的记忆工具，而不是用来给别人解释的适合的工具。

当没有意识到这一点的人在使用这个模型给客户解释的时候，会向客户描述成：“问题域的战略设计”、“问题域的战术设计”、“解决方案域的战略设计”以及“解决方案的战术设计”。

经过实战证明，这种方式不到1分钟，就能让客户及对DDD理论没有深入了解的人晕菜，屡试不爽。

### 它们是从哪儿来的？

在搞清楚这个问题之前，我们先要追本溯源，看看这些概念是从哪里来的。

#### 问题域 / 方案域 / 实现域

什么是问题域？

什么是方案域？

什么是实现域？

非常有意思的是，以上名词在我搜索的过程中，能够搜到的结果绝大多数都是和软件系统的业务分析及领域驱动设计相关的，当然他们还有很多不同的翻译或者别称。具体到底最初是哪里定义了这三个词汇，我目前还无从查证。但仅从字面上来说，**这是其实是一个非常自然的，人类解决问题的过程**。

我不想用书本上或者别人博客里的概念进行重复介绍，我更喜欢用我在做咨询的时候总是会用一个屡试不爽的小测试来让大家体会。

首先，我会问：

> 我：“我饿了。”

然后，我会让大家根据这个问题来接一句话去将对话接下去，这时候很多人会这样说：

> 客户A：“你吃什么？”
> 客户B：“走，一起吃饭去？”
> 客户C：“你想什么时候吃？”
> ……

以上就是绝大多数人所习惯的基于方案而非问题进行回答的方式。但一个更正确的，体现问题驱动的答法应该是：

> 某善于问题驱动的客户：“你为什么饿了？”

这时候，接下来我的回答有可能是：

> 我：“我中午加班开会，时间比较紧，下午还要来给大家做工作坊，所以中午没吃饭，现在感觉有些低血糖。”

最后，得到的答案往往就会跟之前有很大不同：

> 客户A：“要不要我给你找点吃的你先垫一垫？”
> 客户B：“要不我们先暂停工作坊你去吃点东西？”
> ……

在这个例子中，包含几个不同的部分：

- 待解决问题：我饿了
- 问题澄清的结果：中午加班开会，时间比较紧，下午还要来给大家做工作坊，所以中午没吃饭，现在感觉有些低血糖
- 解决方案：先垫一垫 or 暂停工作坊去吃东西
- 实现细节：先吃块儿巧克力 or 去外面吃快餐

让我给予一个简单而非严谨的总结：

**问题需要被澄清，问题澄清的结果决定解决方案，问题往往会有多种解决方案，每种解决方案的落地过程是实现细节。**

那么，所谓的“问题域”无非就是“待解决问题的集合”，“方案域”便是“解决方案的集合”，“实现域”便是“实现细节的集合”。而**“领域驱动”**，其实就是**“问题驱动”**——**从澄清关键业务问题开始，逐渐寻找适合的解决方案，再到确定实现细节的过程。**

#### 战略设计 / 战术设计

说到“战略设计”和“战术设计”，这两个词的来源也非常有意思。

##### Eric Evans最初的解释

“战略设计（strategic design）”一词最早来自于2004年Eric Evans最初的《领域驱动设计：软件核心复杂性应对之道》一书的最后一个部分（第四部分：战略设计），他的原意是：

> 一种针对系统整体的建模和设计决策。这样的决策影响整个项目，而且必须由团队来制定。

在Eric Evans的书中，战略设计会优先关注限界上下文以及限界上下文之间的协作关系，然后通过精炼的方式得到核心域和通用域等“模式”。而在整个书中，其实有关于统一语言和建模的细节都是在全书的前三个部分讨论的，

也就是说，在最初的这本书中，并没有“战术设计”一词，而Eric Evans是先说的“战术”后说的“战略”。因为他认为：

> 随着系统的增长，它会变得越来越复杂，当我们无法通过分析对象来理解系统的时候，就需要掌握一些操纵和理解大模型的技术了。本书的这一部分将介绍一些原则。遵循这些原则，就可以对非常复杂的领域进行建模。大部分这样的决策都需要由团队来制定，甚至需要多个团队共同协商制定。这些决策往往是把设计和策略综合到一起的结果。

换句话说，其实他先是介绍的“简单”的系统的领域驱动设计和建模方法，而在最后才介绍的是“复杂”的系统的领域驱动设计和分析方法。

我相信，但凡知道伟大领袖毛主席“在战略上藐视敌人，在战术上重视敌人”这句话的人（或者习惯从宏观到微观思考问题的人），在阅读最初的这本书时，一定会和我一样，对Eric Evans从细节到宏观的叙事顺序感到有种顺序上的不适。

当然，这种不适肯定不是少数人，在2013年，一本DDD发展史上非常重要的另一本书诞生了。

##### Vaughn Vernon的发展

2013年，Vaughn Vernon在实施了很长时间以“实现领域驱动设计”为核心内容的工作坊之后，出版了《实现领域驱动设计》一书，在这本书中，他按照从宏观到微观，从问题到方案再到实现的方式进行了叙述，发展并完善了DDD的理论和概念，当然也引入了“问题空间”和“解决方案空间”这两个词。

他认为，在DDD的“战略设计中”，还需要考虑“问题空间”和“解决方案空间”这样的维度，其中子域（他在“核心域”和“通用域”之间加入“支撑域”来避免两个极端）属于“战略设计”对于“问题空间”的分析方式，而限界上下文则是属于“战略设计”对于“解决方案空间”的分析方式。

至于“战术设计”一词，hum……当时还没出现呢……

*（直到2016年，Vaughn Vernon的《领域驱动设计精粹》一书，才将“战术设计”一词放到了书里，他认为，“战术设计”的核心是以聚合为代表的领域建模过程。别着急，马上就会看到这个词更早一年出现在另一本书里）。*

那么“战术设计”这个词，到底是什么时候才出现的呢？

##### Scott Millett与Nick Tune被“忽略”的澄清

说实话，“战术设计”这个大家看到现在基本都已经感受到是什么了的东西，到底什么时候由谁提出的，已经难以追溯，但是，至少有一本书出现了……

在2015年，Scott Millett和Nick Tune出版了《领域驱动设计模式、原理与实践》一书，这本书更加全面和细致的介绍了在实现DDD的过程中的思考和方法。

然而很可惜的是，这一本书的中文版已经“绝版了”，说明至少在中国，大家的注意力都被《实现领域驱动设计》带跑了，逢人便提IDDD（书名的缩写），却很少有人提到前述的这一本（当然，我强烈建议对照看英文版，中文版翻译的实在是……）。

在这本书中，作者将全书分为了四个部分:

1. 领域驱动设计的原则与实践
2. 战略模式：在限界上下文之间通信
3. 战术模式：创建有效的领域模型
4. 有效应用程序的设计模式

至此，在DDD的系列书籍中，终于出现了“战术设计/模式”一词，Scott Millett和Nick Tune把领域模型的设计全部清晰的纳入到了“战术设计”之中。

### 为什么大多数人会难以理解？

好吧，大家能看到这里已经很不容易了，让我来为大家做总结并回答一下为什么大多数人会难以理解前述的两个维度的概念呢？

答案很简单：看书太少，动脑太少……咳咳……（手动滑稽）

好吧好吧，让我们严肃点……其实这个问题我是这么看的，之所以难以理解，问题来自于两个方面：

- DDD“依然年轻”
- 大多数人的能力缺陷

让我们分别来说。

#### DDD“依然年轻”

DDD虽然从2014年开始，截止到刚刚过去的2019年，已经有15年的发展，但是15年来，虽然软件架构和设计的新思想层出不穷，复杂度也越来越高。

直到2014年，以Martin Fowler为代表，在博客上彻底点燃微服务设计这个“燎原之火”之后，微服务所带来的软件系统的复杂度成倍提升才使得人们又重新关注，并开始根据新的形势认真思考DDD如何落地（到如今，几乎逢领微服务设计的书，必谈DDD）。

从前面的介绍和几本书的内容发展我们可以看到，DDD思想发展的时间跨越很大，语言和理解的统一也并不顺畅，很多概念的清晰化都是最近几年才密集出现。

尤其在中国，发展更为滞后。这个圈子里，有机会深入思考和深耕DDD规模化落地的人也不多。

所以，DDD如何在中国这个能够产出“中台”思想的地方实现规模化落地和创新发展，依然任重而道远。

#### 大多数人的能力缺陷

##### 大多数人并不善于问题驱动

##### 大多数人并不善于分层思维

##### 大多数人并不善于多维思考

## 更合理的“DDD分段式设计”

### 战略设计

#### 事件风暴工作坊

#### 限界上下文分析

#### 子域分析

#### 弹性边界分析

### 战术设计

#### 领域建模

#### 业务服务识别

#### 业务服务接口能力识别

### 技术实现

## 在基准化过程中的实际效果

---

## 参考资料

- [用TDD思想对DDD的协作设计过程进行基准化](https://huhao.dev/posts/130bb570/)
- [当Subdomain遇见Bounded Context](https://insights.thoughtworks.cn/subdomain-and-bounded-context/)